# ============================================================
# FORMAT_BOUNDARY_CONTRACT — AUTHORITATIVE GOVERNANCE CONTRACT
# ============================================================

[anchor]
anchor_id = "sswg_format_boundary_contract"
anchor_model = "sswg+mvm+version"
anchor_version = "1.0.0"
scope = "directive_core/docs"
status = "invariant"
output_mode = "non_operational_output"

owner = [
  "2025© Raven Recordings",
  "Tommy Raven (Thomas Byers)"
]

init_purpose = "Define canonical format boundary flows and enforcement requirements."
init_authors = ["Tommy Raven"]

# ------------------------------------------------------------
# SECTION 1 — CONTRACT AUTHORITY AND PRECEDENCE
# ------------------------------------------------------------

[contract]

authoritative = true
single_source_of_truth = true
waivable = false

ingestion_position = 4
must_exist = true
absence_is_fatal = true
malformed_is_fatal = true

# ------------------------------------------------------------
# SECTION 2 — CANONICAL FORMAT ROLES
# ------------------------------------------------------------

[formats]

yaml_core_role = "human_expression_only"
toml_core_role = "authoritative_enforcement_surface"
json_role = "canonical_machine_truth"
markdown_role = "documentation_only"

yaml_authoritative = false
markdown_authoritative = false
toml_authoritative = true
json_authoritative = true

# ------------------------------------------------------------
# SECTION 3 — ALLOWED FLOWS (EXHAUSTIVE)
# ------------------------------------------------------------

[[allowed_flow]]
id = "human_to_machine_authoring"
sequence = [
  "human",
  "YAML_core",
  "SemanticAmbiguityGate",
  "normalize_YAML_to_TOML",
  "TOML_core_enforced",
  "machine"
]

[[allowed_flow]]
id = "machine_to_human_presentation"
sequence = [
  "machine",
  "TOML_core_enforced",
  "render_TOML_to_Markdown",
  "human"
]

[[allowed_flow]]
id = "machine_to_machine_exchange"
sequence = [
  "machine",
  "TOML_core_enforced",
  "machine"
]

# ------------------------------------------------------------
# SECTION 4 — FORBIDDEN FLOWS (ABSOLUTE)
# ------------------------------------------------------------

[[forbidden_flow]]
reason = "Humans must not author authoritative TOML"
sequence = ["human", "TOML_core"]

[[forbidden_flow]]
reason = "Machines must not emit YAML as authority"
sequence = ["machine", "YAML_core"]

[[forbidden_flow]]
reason = "YAML must not reach machines without enforcement"
sequence = ["YAML_core", "machine"]

[[forbidden_flow]]
reason = "Markdown is never authority-bearing"
sequence = ["Markdown", "machine"]

implicit_or_undocumented_flows_forbidden = true

# ------------------------------------------------------------
# SECTION 5 — GATE REQUIREMENTS
# ------------------------------------------------------------

[gates.semantic_ambiguity]

required = true
executes_before_normalization = true
fail_closed = true

public_error_label = "Semantic Ambiguity"

must_not_expose = [
  "rule_ids",
  "pattern_names",
  "remediation_hints"
]

[gates.normalization]

deterministic = true
anchors_expanded = true
implicit_structure_eliminated = true

[gates.toml_enforcement]

schema_validation_required = true
additional_properties_forbidden = true

# ------------------------------------------------------------
# SECTION 6 — FAILURE SEMANTICS
# ------------------------------------------------------------

[failure]

on_violation = [
  "fail_closed",
  "reject_immediately",
  "quarantine_artifact",
  "exclude_from_ingestion"
]

public_message_generic = true
guidance_forbidden = true

audit_logging_allowed = true
audit_log_scope = "directive_core/artifacts/audit"

# ------------------------------------------------------------
# END OF FORMAT_BOUNDARY_CONTRACT
# ------------------------------------------------------------
