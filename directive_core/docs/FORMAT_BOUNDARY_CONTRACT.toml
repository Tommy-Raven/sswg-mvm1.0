[anchor]
anchor_id = "sswg_format_boundary_contract"
anchor_model = "sswg+mvm+version"
anchor_version = "1.0.1"
scope = "directive_core/docs"
status = "invariant"
output_mode = "non_operational_output"

owner = [
  "2025Â© Raven Recordings",
  "Tommy Raven (Thomas Byers)"
]

init_purpose = "Define canonical format boundary flows, authority surfaces, and enforcement requirements."
init_authors = ["Tommy Raven"]


[contract]

authoritative = true
single_source_of_truth = true
waivable = false
mutable = false

ingestion_position = 4
must_exist = true
absence_is_fatal = true
malformed_is_fatal = true


[formats]

yaml_core_role = "human_expression_only"
toml_core_role = "authoritative_enforcement_surface"
json_role = "canonical_machine_truth"
markdown_role = "documentation_only"

yaml_authoritative = false
markdown_authoritative = false
toml_authoritative = true
json_authoritative = true

json_derives_from_toml = true
json_never_source_of_authority = true

markdown_render_direction = "toml_to_markdown_only"
markdown_roundtrip_forbidden = true
markdown_never_ingested = true


[[allowed_flow]]
id = "human_to_machine_authoring"
sequence = [
  "human",
  "YAML_core",
  "SemanticAmbiguityGate",
  "normalize_YAML_to_TOML",
  "TOML_core_enforced",
  "machine"
]

[[allowed_flow]]
id = "machine_to_human_presentation"
sequence = [
  "machine",
  "TOML_core_enforced",
  "render_TOML_to_Markdown",
  "human"
]

[[allowed_flow]]
id = "machine_to_machine_exchange"
sequence = [
  "machine",
  "TOML_core_enforced",
  "machine"
]

allowed_flows_exhaustive = true


[[forbidden_flow]]
reason = "Humans must not author authoritative TOML"
sequence = ["human", "TOML_core"]

[[forbidden_flow]]
reason = "Machines must not emit YAML as authority"
sequence = ["machine", "YAML_core"]

[[forbidden_flow]]
reason = "YAML must not reach machines without enforcement"
sequence = ["YAML_core", "machine"]

[[forbidden_flow]]
reason = "Markdown is never authority-bearing"
sequence = ["Markdown", "machine"]

implicit_or_undocumented_flows_forbidden = true
reverse_flows_forbidden = true
roundtrip_flows_forbidden = true


[gates.semantic_ambiguity]

required = true
executes_before_normalization = true
executes_before_any_validation = true
fail_closed = true

public_error_label = "Semantic Ambiguity"

must_not_expose = [
  "rule_ids",
  "pattern_names",
  "regex_signatures",
  "remediation_hints"
]

[gates.normalization]

deterministic = true
anchors_expanded = true
implicit_structure_eliminated = true
ordering_preserved = true

[gates.toml_enforcement]

schema_validation_required = true
additional_properties_forbidden = true
unknown_tables_forbidden = true


[failure]

on_violation = [
  "fail_closed",
  "reject_immediately",
  "quarantine_artifact",
  "exclude_from_ingestion",
  "record_audit_event"
]

public_message_generic = true
guidance_forbidden = true
interpretation_forbidden = true

audit_logging_allowed = true
audit_log_scope = "directive_core/artifacts/audit"
audit_logs_append_only = true

