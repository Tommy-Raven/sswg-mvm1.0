pipeline_profile: full_9_phase
phases:
  - name: ingest
    type: data
    enabled: true
    description: "Collect inputs without interpretation."
    inputs:
      - id: raw_payload
        type: blob
        description: "Source material for the run."
    outputs:
      - id: ingested_payload
        type: blob
        description: "Raw inputs preserved for later phases."
    handler: pdl.handlers.ingest
    constraints:
      no_interpretation: true
      no_mutation_of_canonical: true

  - name: normalize
    type: normalize
    enabled: true
    description: "Normalize inputs deterministically."
    inputs:
      - id: ingested_payload
        type: blob
    outputs:
      - id: normalized_payload
        type: blob
    handler: pdl.handlers.normalize
    constraints:
      deterministic_required: true
      alignment_rules_required: true

  - name: parse
    type: parse
    enabled: true
    description: "Bind normalized payloads to schema-aware structures."
    inputs:
      - id: normalized_payload
        type: blob
    outputs:
      - id: parsed_payload
        type: structured
    handler: pdl.handlers.parse
    constraints:
      schema_binding_required: true
      no_generation: true

  - name: analyze
    type: analysis
    enabled: true
    description: "Measure / analyze without generative tools for measurement."
    inputs:
      - id: parsed_payload
        type: structured
    outputs:
      - id: analysis_metrics
        type: metrics
    handler: pdl.handlers.analyze
    constraints:
      deterministic_required: true
      no_generative_tools_for_measurement: true

  - name: generate
    type: generation
    enabled: true
    description: "Generate declarative outputs."
    inputs:
      - id: analysis_metrics
        type: metrics
    outputs:
      - id: generated_output
        type: artifact
    handler: pdl.handlers.generate
    constraints:
      outputs_must_be_declarative: true
      no_measurement_keys_generated_stochastically: true

  - name: validate
    type: validation
    enabled: true
    description: "Validate schemas and invariants."
    inputs:
      - id: generated_output
        type: artifact
    outputs:
      - id: validated_output
        type: artifact
    handler: pdl.handlers.validate
    constraints:
      deterministic_required: true
      schema_validation_required: true
      invariants_required: true

  - name: compare
    type: comparison
    enabled: true
    description: "Deterministic comparisons on measured artifacts."
    inputs:
      - id: validated_output
        type: artifact
    outputs:
      - id: comparison_report
        type: report
    handler: pdl.handlers.compare
    constraints:
      deterministic_required: true
      overlap_metrics_allowed:
        - iou

  - name: interpret
    type: interpretation
    enabled: true
    description: "Interpret results referencing measured artifacts."
    inputs:
      - id: comparison_report
        type: report
    outputs:
      - id: interpretation_summary
        type: summary
    handler: pdl.handlers.interpret
    constraints:
      must_reference_measured_artifacts: true
      output_must_be_labeled_nondeterministic: true

  - name: log
    type: logging
    enabled: true
    description: "Emit telemetry and trace artifacts."
    inputs:
      - id: interpretation_summary
        type: summary
    outputs:
      - id: audit_log
        type: log
    handler: pdl.handlers.log
    constraints:
      run_id_required: true
      inputs_hash_required: true
      phase_status_required: true
